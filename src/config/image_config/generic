#!/bin/bash
# A script which replicates the ansible role: 

generic_role() {
  apt-get install -y $OS_PACKAGES
  apt-get purge -y $OS_BANNED_PACKAGES

  sed -i 's/us/uk/g' work/rootfs/etc/default/keyboard

  rsync --chmod 0444 $FILE_LOCATION/70-u2f.rules /etc/udev/rules.d/70-u2f.rules
  rsync --chmod 0444 $FILE_LOCATION/50unattended-upgrades /etc/apt/apt.conf.d/50unattended-upgrades
  rsync --chmod 0644 $FILE_LOCATION/grub /etc/bash_completion.d/grub
  rsync --chmod 0755 $FILE_LOCATION/rkhunter.sh /etc/cron.daily/rkhunter.sh
  rsync --chmod 0644 $FILE_LOCATION/rkhunter.conf /etc/rkhunter.conf
  # Any files attached by a USB will be owned by root
  rsync --chmod 0755 $FILE_LOCATION/chown_usb /usr/local/bin/chown_usb

  systemctl enable pcscd

  # Lazy way of making people use gpg
  mv /usr/bin/gpg /usr/bin/.gpg_old
  ln -s /usr/bin/gpg2 /usr/bin/gpg
}

OS_PACKAGES="""
  curl
  acpid
  bash-completion
  bzip2
  coreutils
  dmidecode
  dos2unix
  dstat
  e2fsprogs
  elinks
  groff
  htop
  jq
  inotify-tools
  irqbalance
  logrotate
  ltrace
  lvm2
  lynx
  ncdu
  ngrep
  nmap
  ntp
  ntpdate
  man
  mlocate
  mr
  mtr
  multitail
  openssh-server
  openvpn
  parted
  pciutils
  perl
  policycoreutils
  pv
  python-pip
  rcs
  rkhunter
  rng-tools
  rsync
  screen
  sshuttle
  sudo
  sssd
  sssd-tools
  sssd-common
  sysstat
  strace
  tar
  tcl
  terminator
  tk
  tree
  unzip
  wget
  vim-common
  zip
  apparmor-profiles
  apparmor-utils
  apt-transport-https
  bind9utils
  dnsutils
  git-crypt
  gnupg-pkcs11-scd
  iwatch
  iptables-persistent
  kernel-package
  libccid
  libu2f-host0
  libpam-yubico
  libreadline-dev
  libykclient3
  libykpers-1-1
  netcat
  opensc
  opensc-pkcs11
  openssh-client
  pinentry-curses
  pcscd
  pcsc-tools
  python3
  python3-pip
  python3-httplib2
  scdaemon
  shellcheck
  strace
  systemd-container
  tig
  ubuntu-restricted-extras
  virtualenv
  whois
  yubikey-luks
  yubikey-ksm
  yubico-piv-tool
  vim-scripts
  zlib1g-dev
"""

OS_BANNED_PACKAGES="""
  gnome-mines
  aisleriot
  account-plugin-facebook
  account-plugin-flickr
  gnome-mahjongg
  gnome-sudoku
  ace-of-penguins
  brainparty
  brainparty-data
  bsdgames
  childsplay
  crossfire-server
  cube2-server
  cube2font
  darkplaces
  darkplaces-server
  eureka
  fenix-dev
  fizmo-console
  fizmo-ncursesw
  flare-engine
  fltk1.1-games
  fltk1.3-games
  freecell-solver-bin
  gameclock
  games-adventure
  games-arcade
  games-board
  games-c++-dev
  games-card
  games-chess
  games-console
  games-content-dev
  games-education
  games-emulator
  games-finest
  games-finest-light
  games-fps
  games-java-dev
  games-minesweeper
  games-mud
  games-perl-dev
  games-platform
  games-programming
  games-puzzle
  games-python2-dev
  games-python3-dev
  games-racing
  games-rogue
  games-rpg
  games-shootemup
  games-simulation
  games-sport
  games-strategy
  games-tasks
  games-tetris
  games-thumbnails
  games-toys
  games-typing
  gargoyle-free
  gausssum
  gcompris
  gcstar
  glbsp
  gnome-cards-data
  gnome-games
  gnustep-games
  goban-original-games
  goplay
  gridlock.app
  gtkboard
  ioquake3
  ioquake3-server
  junior-games-adventure
  junior-games-arcade
  junior-games-card
  junior-games-gl
  junior-games-net
  junior-games-puzzle
  junior-games-sim
  junior-games-text
  kde-games-core-declarative
  kdegames-card-data
  kdegames-card-data-kf5
  kdegames-mahjongg-data
  kdegames-mahjongg-data-kf5
  kpat
  libfreecell-solver-dev
  libfreecell-solver0
  libglbsp-dev
  libglbsp3
  libgrapple-1.0-1
  libgrapple-dev
  libkdegames-dev
  libkdegames6abi1
  libkdegames6abi1-dbg
  libkdegamesprivate1abi1
  libkf5kdegames-dev
  libkf5kdegames7
  libkf5kdegamesprivate1
  libtuxcap-dev
  libtuxcap4.0
  libtuxcap4.0-dbg
  lxgames-default-session
  ogamesim
  ogamesim-www
  onscripter
  plasma-widget-pgame
  pysolfc
  python-pygame
  python-renpy
  qml-module-org-kde-games-core
  quarry
  renpy
  renpy-demo
  renpy-doc
  scottfree
  scummvm
  scummvm-data
  sgt-puzzles
  sludge-compiler
  sludge-devkit
  sludge-engine
  stax
  tagua
  texlive-games
  unity-webapps-googleplusgames
  vdr-plugin-games
  xpilot-ng-server
  xsystem35
  zoom-player
  fenix
  bsdgames-nonfree
  exult-studio
"""
